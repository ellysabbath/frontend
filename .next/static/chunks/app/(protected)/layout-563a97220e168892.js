(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[163],{1886:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var a=r(9483),n=r(3464),o=r(7383);let i="https://bahifinal.pythonanywhere.com/api/auth",s=n.A.create({baseURL:i,headers:{"Content-Type":"application/json"}});s.interceptors.request.use(e=>{let t=o.A.get(a.X);return t&&e.headers&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),s.interceptors.response.use(e=>e,async e=>{var t;let r=e.config;if((null==(t=e.response)?void 0:t.status)===401&&!r._retry){r._retry=!0;let e=o.A.get(a.a);if(e)try{let{data:t}=await n.A.post("".concat(i,"/token/refresh/"),{refresh:e}),c=t.access;return o.A.set(a.X,c,{sameSite:"Strict"}),r.headers.Authorization="Bearer ".concat(c),s(r)}catch(e){o.A.remove(a.X),o.A.remove(a.a),window.location.href="/login"}}return Promise.reject(e)});let c=s},2596:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>l});var a=r(5155),n=r(2115),o=r(7383),i=r(9483),s=r(7446),c=r(5695),u=r(8869);let l=e=>{let{children:t}=e,[r,l]=(0,n.useState)(!0);return((0,n.useEffect)(()=>{(async()=>{if(!o.A.get(i.X))return(0,c.redirect)("/login");try{await s.u.getUserProfile()}catch(e){console.error("Failed to fetch user data:",e),s.u.logout(),(0,c.redirect)("/login")}l(!1)})()},[]),r)?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center font-bold bg-gray-100",children:"wait redirecting ......"}):(0,a.jsx)(u.O,{children:t})}},4224:(e,t,r)=>{Promise.resolve().then(r.bind(r,2596))},5695:(e,t,r)=>{"use strict";var a=r(8999);r.o(a,"redirect")&&r.d(t,{redirect:function(){return a.redirect}}),r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}})},7383:(e,t,r)=>{"use strict";function a(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)e[a]=r[a]}return e}r.d(t,{A:()=>n});var n=function e(t,r){function n(e,n,o){if("undefined"!=typeof document){"number"==typeof(o=a({},r,o)).expires&&(o.expires=new Date(Date.now()+864e5*o.expires)),o.expires&&(o.expires=o.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var i="";for(var s in o)o[s]&&(i+="; "+s,!0!==o[s]&&(i+="="+o[s].split(";")[0]));return document.cookie=e+"="+t.write(n,e)+i}}return Object.create({set:n,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var r=document.cookie?document.cookie.split("; "):[],a={},n=0;n<r.length;n++){var o=r[n].split("="),i=o.slice(1).join("=");try{var s=decodeURIComponent(o[0]);if(a[s]=t.read(i,s),e===s)break}catch(e){}}return e?a[e]:a}},remove:function(e,t){n(e,"",a({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,a({},this.attributes,t))},withConverter:function(t){return e(a({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})},7446:(e,t,r)=>{"use strict";r.d(t,{u:()=>i});var a=r(9483),n=r(7383),o=r(1886);let i={register:async e=>{try{return(await o.A.post("".concat("","/register/"),e)).data}catch(e){console.log("Error in AuthService.register:",e)}},login:async(e,t)=>{try{let r=await o.A.post("".concat("","/login/"),{email:e,password:t});if(200===r.status){let{access:e,refresh:t}=r.data,o={expires:1,secure:!0};return n.A.set(a.X,e,o),n.A.set(a.a,t,{...o,expires:7}),r.data}}catch(e){console.log("Error in AuthService.login: ",e)}},verifyEmail:async e=>{try{let t=await o.A.get("".concat("","/verify-email/").concat(e,"/"));if(200===t.status){let{access:e,refresh:r}=t.data,o={expires:1,secure:!0};return n.A.set(a.X,e,o),n.A.set(a.a,r,{...o,expires:7}),t.data}}catch(e){return console.log("Error in AuthService.sendVerificationEmail:",e),{error:e instanceof Error?e.message:"An error occurred while verifying email"}}},resendVerificationEmail:async e=>{try{let t=await o.A.post("".concat("","/resend-verification-email/"),{email:e});if(200===t.status)return t.data}catch(e){console.log("Error in AuthService.resendVerificationEmail:",e)}},getUserProfile:async()=>{try{return(await o.A.get("".concat("","/profile/"))).data}catch(e){console.log("Error in AuthService.getUserProfile:",e)}},logout:async()=>{try{let e=await o.A.post("".concat("","/logout/"),{refresh_token:n.A.get(a.a)});return n.A.remove(a.X),n.A.remove(a.a),e.data}catch(e){console.log("Error in AuthService.logout:",e),n.A.remove(a.X),n.A.remove(a.a)}}}},8869:(e,t,r)=>{"use strict";r.d(t,{A:()=>u,O:()=>c});var a=r(5155),n=r(2115),o=r(1886),i=r(7383);let s=(0,n.createContext)(void 0);function c(e){let{children:t}=e,[r,c]=(0,n.useState)(null),[u,l]=(0,n.useState)(!0);(0,n.useEffect)(()=>{(async()=>{if(i.A.get("access_token"))try{await v()}catch(e){console.error("Failed to fetch user data:",e),f()}l(!1)})()},[]);let d=async(e,t)=>{try{let{access:r,refresh:a,user:n}=(await o.A.post("/auth/login/",{email:e,password:t})).data;i.A.set("access_token",r,{expires:1}),i.A.set("refresh_token",a,{expires:7}),c(n)}catch(e){var r,a;throw Error((null==(a=e.response)||null==(r=a.data)?void 0:r.detail)||"Login failed")}},h=async e=>{try{await o.A.post("/auth/register/",e)}catch(e){var t,r,a,n,i,s;throw Error((null==(a=e.response)||null==(r=a.data)||null==(t=r.email)?void 0:t[0])||(null==(s=e.response)||null==(i=s.data)||null==(n=i.username)?void 0:n[0])||"Registration failed")}},f=()=>{let e=i.A.get("refresh_token");e&&o.A.post("/auth/logout/",{refresh_token:e}).catch(()=>{}),i.A.remove("access_token"),i.A.remove("refresh_token"),c(null)},p=async e=>{try{let t=await o.A.patch("/auth/profile/update/",e);c(t.data)}catch(e){var t,r;throw Error((null==(r=e.response)||null==(t=r.data)?void 0:t.detail)||"Profile update failed")}},v=async()=>{try{let e=await o.A.get("/current-user/");c(e.data)}catch(e){throw e}};return(0,a.jsx)(s.Provider,{value:{user:r,loading:u,login:d,register:h,logout:f,updateProfile:p,refreshUserData:v},children:t})}function u(){let e=(0,n.useContext)(s);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},9483:(e,t,r)=>{"use strict";r.d(t,{X:()=>a,a:()=>n});let a="access_token",n="refresh_token"}},e=>{var t=t=>e(e.s=t);e.O(0,[464,441,684,358],()=>t(4224)),_N_E=e.O()}]);