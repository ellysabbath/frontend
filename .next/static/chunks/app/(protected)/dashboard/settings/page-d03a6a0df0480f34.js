(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[157],{408:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>o});var s=r(5155),a=r(2115),n=r(8869),l=r(4752),i=r.n(l);function o(){let{user:e}=(0,n.A)(),[t,r]=(0,a.useState)({id:"",email:"",first_name:"",last_name:"",full_name:"",role:"",bio:"",profile_picture:"",is_newsletter_subscribed:!1,website_url:"",github_url:"",linkedin_url:"",profile_completion_percentage:0,is_profile_complete:!1}),[l,o]=(0,a.useState)(!0),[c,d]=(0,a.useState)(null),[u,m]=(0,a.useState)(!1),[h,x]=(0,a.useState)({notifications:!0,emailUpdates:!1,darkMode:!1,autoSave:!0,language:"english"}),p="/api/profile",f=e=>{i().fire({toast:!0,position:"top-end",icon:"success",title:e,showConfirmButton:!1,timer:3e3,timerProgressBar:!0,didOpen:e=>{e.addEventListener("mouseenter",i().stopTimer),e.addEventListener("mouseleave",i().resumeTimer)}})},b=e=>{i().fire({toast:!0,position:"top-end",icon:"error",title:e,showConfirmButton:!1,timer:4e3,timerProgressBar:!0,didOpen:e=>{e.addEventListener("mouseenter",i().stopTimer),e.addEventListener("mouseleave",i().resumeTimer)}})};(0,a.useEffect)(()=>{(async()=>{try{o(!0),d(null);let e=await fetch("".concat(p,"/current-user/"),{credentials:"include",headers:{"Content-Type":"application/json"}});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||"Failed to fetch user data: ".concat(e.status))}let t=await e.json();r(t)}catch(t){console.error("Error fetching user data:",t);let e=t.message||"Failed to load user data. Please try again later.";d(e),b(e)}finally{o(!1)}})()},[]);let g=(e,t)=>{r(r=>({...r,[e]:t}))},v=(e,t)=>{x(r=>({...r,[e]:t}))},y=e=>{r(t=>({...t,[e]:!t[e]}))},j=async s=>{s.preventDefault(),d(null);try{if(!(null==e?void 0:e.id))throw Error("User ID not available");m(!0);let s=await fetch("".concat(p,"/users/").concat(e.id,"/"),{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({first_name:t.first_name,last_name:t.last_name,bio:t.bio,website_url:t.website_url,github_url:t.github_url,linkedin_url:t.linkedin_url,is_newsletter_subscribed:t.is_newsletter_subscribed})});if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.error||"Failed to update: ".concat(s.status))}let a=await s.json();r(a),f("Settings updated successfully!")}catch(t){console.error("Error updating settings:",t);let e=t.message||"Failed to update settings. Please try again.";d(e),b(e)}finally{m(!1)}};return l?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading user data..."})]})}):c&&!t.email?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"bg-white p-6 rounded-lg shadow-md max-w-md w-full",children:[(0,s.jsx)("div",{className:"text-red-600 mb-4 text-center",children:(0,s.jsx)("svg",{className:"w-16 h-16 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,s.jsx)("div",{className:"text-red-800 text-center mb-6",children:c}),(0,s.jsx)("button",{className:"w-full bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700",onClick:()=>window.location.reload(),children:"Try Again"})]})}):(0,s.jsxs)("div",{className:"p-6 min-h-screen bg-gray-50",children:[(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Settings"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Manage your account preferences and settings"})]}),c&&(0,s.jsx)("div",{className:"mb-6 bg-red-50 p-4 rounded-md",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,s.jsx)("div",{className:"ml-3",children:(0,s.jsx)("h3",{className:"text-sm font-medium text-red-800",children:c})})]})}),(0,s.jsx)("form",{onSubmit:j,children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,s.jsx)("div",{className:"p-6 border-b",children:(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-800",children:"Account Settings"})}),(0,s.jsxs)("div",{className:"p-6 space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-md font-medium text-gray-800 mb-4",children:"Profile Information"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"First Name"}),(0,s.jsx)("input",{type:"text",value:t.first_name,onChange:e=>g("first_name",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"First Name"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Last Name"}),(0,s.jsx)("input",{type:"text",value:t.last_name,onChange:e=>g("last_name",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Last Name"})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Email"}),(0,s.jsx)("input",{type:"email",value:t.email,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 bg-gray-100",readOnly:!0,disabled:!0}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Email cannot be changed"})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Bio"}),(0,s.jsx)("textarea",{rows:4,value:t.bio,onChange:e=>g("bio",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Tell us about yourself"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-md font-medium text-gray-800 mb-4",children:"Social Links"}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Website"}),(0,s.jsx)("input",{type:"url",value:t.website_url,onChange:e=>g("website_url",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://example.com"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"GitHub"}),(0,s.jsx)("input",{type:"url",value:t.github_url,onChange:e=>g("github_url",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://whatsapp/chat/me"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"LinkedIn"}),(0,s.jsx)("input",{type:"url",value:t.linkedin_url,onChange:e=>g("linkedin_url",e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"https://facebook.com/in/username"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-md font-medium text-gray-800 mb-4",children:"Newsletter"}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",id:"newsletter",checked:t.is_newsletter_subscribed,onChange:()=>y("is_newsletter_subscribed"),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,s.jsx)("label",{htmlFor:"newsletter",className:"ml-2 block text-sm text-gray-700",children:"Subscribe to newsletter"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-md font-medium text-gray-800 mb-4",children:"Preferences"}),(0,s.jsx)("div",{className:"space-y-4",children:[{label:"Enable Notifications",field:"notifications"},{label:"Email Updates",field:"emailUpdates"},{label:"Dark Mode",field:"darkMode"},{label:"Auto Save",field:"autoSave"}].map(e=>(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("input",{type:"checkbox",id:e.field,checked:!!h[e.field],onChange:t=>v(e.field,t.target.checked),className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"}),(0,s.jsx)("label",{htmlFor:e.field,className:"ml-2 block text-sm text-gray-700",children:e.label})]},e.field))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-md font-medium text-gray-800 mb-4",children:"Language & Region"}),(0,s.jsxs)("select",{value:h.language,onChange:e=>v("language",e.target.value),className:"w-full md:w-64 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,s.jsx)("option",{value:"english",children:"English"}),(0,s.jsx)("option",{value:"spanish",children:"Spanish"}),(0,s.jsx)("option",{value:"french",children:"French"}),(0,s.jsx)("option",{value:"german",children:"German"})]})]}),(0,s.jsxs)("div",{className:"flex space-x-4 pt-4",children:[(0,s.jsx)("button",{type:"submit",className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed",disabled:u,children:u?(0,s.jsxs)("span",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):"Save Changes"}),(0,s.jsx)("button",{type:"button",onClick:()=>{window.location.reload()},className:"bg-gray-100 text-gray-700 px-4 py-2 rounded-md hover:bg-gray-200",disabled:u,children:"Cancel"})]})]})]})})]})}},1886:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var s=r(9483),a=r(3464),n=r(7383);let l="https://bahifinal.pythonanywhere.com/api/auth",i=a.A.create({baseURL:l,headers:{"Content-Type":"application/json"}});i.interceptors.request.use(e=>{let t=n.A.get(s.X);return t&&e.headers&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),i.interceptors.response.use(e=>e,async e=>{var t;let r=e.config;if((null==(t=e.response)?void 0:t.status)===401&&!r._retry){r._retry=!0;let e=n.A.get(s.a);if(e)try{let{data:t}=await a.A.post("".concat(l,"/token/refresh/"),{refresh:e}),o=t.access;return n.A.set(s.X,o,{sameSite:"Strict"}),r.headers.Authorization="Bearer ".concat(o),i(r)}catch(e){n.A.remove(s.X),n.A.remove(s.a),window.location.href="/login"}}return Promise.reject(e)});let o=i},2488:(e,t,r)=>{Promise.resolve().then(r.bind(r,408))},7383:(e,t,r)=>{"use strict";function s(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var s in r)e[s]=r[s]}return e}r.d(t,{A:()=>a});var a=function e(t,r){function a(e,a,n){if("undefined"!=typeof document){"number"==typeof(n=s({},r,n)).expires&&(n.expires=new Date(Date.now()+864e5*n.expires)),n.expires&&(n.expires=n.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var l="";for(var i in n)n[i]&&(l+="; "+i,!0!==n[i]&&(l+="="+n[i].split(";")[0]));return document.cookie=e+"="+t.write(a,e)+l}}return Object.create({set:a,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var r=document.cookie?document.cookie.split("; "):[],s={},a=0;a<r.length;a++){var n=r[a].split("="),l=n.slice(1).join("=");try{var i=decodeURIComponent(n[0]);if(s[i]=t.read(l,i),e===i)break}catch(e){}}return e?s[e]:s}},remove:function(e,t){a(e,"",s({},t,{expires:-1}))},withAttributes:function(t){return e(this.converter,s({},this.attributes,t))},withConverter:function(t){return e(s({},this.converter,t),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(t)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})},8869:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,O:()=>o});var s=r(5155),a=r(2115),n=r(1886),l=r(7383);let i=(0,a.createContext)(void 0);function o(e){let{children:t}=e,[r,o]=(0,a.useState)(null),[c,d]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(async()=>{if(l.A.get("access_token"))try{await p()}catch(e){console.error("Failed to fetch user data:",e),h()}d(!1)})()},[]);let u=async(e,t)=>{try{let{access:r,refresh:s,user:a}=(await n.A.post("/auth/login/",{email:e,password:t})).data;l.A.set("access_token",r,{expires:1}),l.A.set("refresh_token",s,{expires:7}),o(a)}catch(e){var r,s;throw Error((null==(s=e.response)||null==(r=s.data)?void 0:r.detail)||"Login failed")}},m=async e=>{try{await n.A.post("/auth/register/",e)}catch(e){var t,r,s,a,l,i;throw Error((null==(s=e.response)||null==(r=s.data)||null==(t=r.email)?void 0:t[0])||(null==(i=e.response)||null==(l=i.data)||null==(a=l.username)?void 0:a[0])||"Registration failed")}},h=()=>{let e=l.A.get("refresh_token");e&&n.A.post("/auth/logout/",{refresh_token:e}).catch(()=>{}),l.A.remove("access_token"),l.A.remove("refresh_token"),o(null)},x=async e=>{try{let t=await n.A.patch("/auth/profile/update/",e);o(t.data)}catch(e){var t,r;throw Error((null==(r=e.response)||null==(t=r.data)?void 0:t.detail)||"Profile update failed")}},p=async()=>{try{let e=await n.A.get("/current-user/");o(e.data)}catch(e){throw e}};return(0,s.jsx)(i.Provider,{value:{user:r,loading:c,login:u,register:m,logout:h,updateProfile:x,refreshUserData:p},children:t})}function c(){let e=(0,a.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},9483:(e,t,r)=>{"use strict";r.d(t,{X:()=>s,a:()=>a});let s="access_token",a="refresh_token"}},e=>{var t=t=>e(e.s=t);e.O(0,[320,464,441,684,358],()=>t(2488)),_N_E=e.O()}]);