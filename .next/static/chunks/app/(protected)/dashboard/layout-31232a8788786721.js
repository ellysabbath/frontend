(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[240],{1886:(e,r,t)=>{"use strict";t.d(r,{A:()=>l});var n=t(9483),a=t(3464),s=t(7383);let o="https://bahifinal.pythonanywhere.com/api/auth",i=a.A.create({baseURL:o,headers:{"Content-Type":"application/json"}});i.interceptors.request.use(e=>{let r=s.A.get(n.X);return r&&e.headers&&(e.headers.Authorization="Bearer ".concat(r)),e},e=>Promise.reject(e)),i.interceptors.response.use(e=>e,async e=>{var r;let t=e.config;if((null==(r=e.response)?void 0:r.status)===401&&!t._retry){t._retry=!0;let e=s.A.get(n.a);if(e)try{let{data:r}=await a.A.post("".concat(o,"/token/refresh/"),{refresh:e}),l=r.access;return s.A.set(n.X,l,{sameSite:"Strict"}),t.headers.Authorization="Bearer ".concat(l),i(t)}catch(e){s.A.remove(n.X),s.A.remove(n.a),window.location.href="/login"}}return Promise.reject(e)});let l=i},5695:(e,r,t)=>{"use strict";var n=t(8999);t.o(n,"redirect")&&t.d(r,{redirect:function(){return n.redirect}}),t.o(n,"useParams")&&t.d(r,{useParams:function(){return n.useParams}}),t.o(n,"usePathname")&&t.d(r,{usePathname:function(){return n.usePathname}}),t.o(n,"useRouter")&&t.d(r,{useRouter:function(){return n.useRouter}})},7151:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>d});var n=t(5155),a=t(2115),s=t(8869),o=t(7446),i=t(5695),l=t(6874),c=t.n(l);function d(e){var r;let{children:t}=e,[l,d]=(0,a.useState)(!1),u=(0,a.useRef)(null),h=(0,i.usePathname)(),{user:m}=(0,s.A)();(0,a.useEffect)(()=>{let e=e=>{u.current&&!u.current.contains(e.target)&&d(!1)};return l&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[l]);let f=async()=>{try{await o.u.logout(),window.location.reload()}catch(e){console.error("Logout error: ",e)}},x=(null==m?void 0:m.role)==="admin"||(null==m?void 0:m.role)==="editor"?[{name:"Home",href:"/dashboard",icon:"\uD83D\uDCCA"},{name:"Departments",href:"/dashboard/departments",icon:"\uD83D\uDCC8"},{name:"Messages & SMS",href:"/dashboard/messages",icon:"✉️"},{name:"Announcements",href:"/dashboard/announcements",icon:"\uD83D\uDCE3"},{name:"Timetable & Calendar",href:"/dashboard/timetable",icon:"\uD83D\uDCC5"},{name:"Users",href:"/dashboard/users",icon:"\uD83D\uDC65"},{name:"Gallery",href:"/dashboard/galary",icon:"\uD83D\uDDBC️"},{name:"Writings",href:"/dashboard/writings",icon:"\uD83D\uDCDA"},{name:"About us",href:"/dashboard/about-us",icon:"ℹ️"},{name:"Settings",href:"/dashboard/settings",icon:"⚙️"},{name:"Profile",href:"/dashboard/profile",icon:"\uD83D\uDC64"},{name:"GoLive",href:"/dashboard/golive",icon:"\uD83C\uDFA5"},{name:"Admin",href:"/dashboard/admin",icon:"\uD83D\uDEE0️"}]:(null==m?void 0:m.role)==="user"?[{name:"Home",href:"/dashboard",icon:"\uD83D\uDCCA"},{name:"DepartmentsUser",href:"/dashboard/departments-user",icon:"\uD83D\uDCC8"},{name:"AnnouncementsUser",href:"/dashboard/announcements-user",icon:"\uD83D\uDCE3"},{name:"TimetableUser & Calendar",href:"/dashboard/timetable-user",icon:"\uD83D\uDCC5"},{name:"Profile",href:"/dashboard/profile",icon:"\uD83D\uDC64"},{name:"About us",href:"/dashboard/about-us",icon:"ℹ️"}]:[];return(0,n.jsxs)("div",{className:"flex h-screen bg-gray-50",children:[l&&(0,n.jsx)("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-50 z-20 lg:hidden",onClick:()=>d(!1)}),(0,n.jsxs)("div",{ref:u,className:"fixed inset-y-0 left-0 z-30 w-64 bg-white shadow-md transform transition-transform duration-300 ease-in-out\n          lg:static lg:translate-x-0 lg:z-auto flex flex-col\n          ".concat(l?"translate-x-0":"-translate-x-full"),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between p-4 border-b flex-shrink-0",children:[(0,n.jsx)("h4",{className:"text-xl font-semibold text-gray-800",children:"BAHI SDA MANAGEMENT SYSTEM"}),(0,n.jsx)("button",{onClick:()=>d(!1),className:"lg:hidden text-gray-500 hover:text-gray-700 p-1 rounded-full hover:bg-gray-100","aria-label":"Close sidebar",children:(0,n.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,n.jsx)("nav",{className:"flex-1 overflow-y-auto",children:(0,n.jsx)("ul",{className:"space-y-2 px-4 py-4",children:x.map(e=>"GoLive"===e.name?(0,n.jsx)("li",{children:(0,n.jsxs)("button",{onClick:()=>window.open("https://videoconf.pythonanywhere.com","_blank"),className:"flex items-center p-3 rounded-lg transition-colors duration-200 text-gray-700 hover:bg-blue-50 hover:text-blue-600 w-full",children:[(0,n.jsx)("span",{className:"mr-3 text-lg",children:e.icon}),(0,n.jsx)("span",{className:"font-medium",children:e.name})]})},e.name):"Admin"===e.name?(0,n.jsx)("li",{children:(0,n.jsxs)("button",{onClick:()=>window.open("https://bahifinal.pythonanywhere.com/admin/","_blank"),className:"flex items-center p-3 rounded-lg transition-colors duration-200 text-gray-700 hover:bg-blue-50 hover:text-blue-600 w-full",children:[(0,n.jsx)("span",{className:"mr-3 text-lg",children:e.icon}),(0,n.jsx)("span",{className:"font-medium",children:e.name})]})},e.name):(0,n.jsx)("li",{children:(0,n.jsxs)(c(),{href:e.href,className:"flex items-center p-3 rounded-lg transition-colors duration-200 ".concat(h===e.href?"bg-blue-50 text-blue-600":"text-gray-700 hover:bg-blue-50 hover:text-blue-600"),onClick:()=>d(!1),children:[(0,n.jsx)("span",{className:"mr-3 text-lg",children:e.icon}),(0,n.jsx)("span",{className:"font-medium",children:e.name})]})},e.name))})}),(0,n.jsx)("div",{className:"flex-shrink-0 p-4 border-t",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center mr-3",children:(0,n.jsx)("span",{className:"text-blue-600 font-semibold",children:(null==m||null==(r=m.username)?void 0:r.charAt(0).toUpperCase())||"U"})}),(0,n.jsx)("div",{children:(0,n.jsx)("p",{className:"text-xs text-gray-500",children:(null==m?void 0:m.role)||""})})]})})]}),(0,n.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,n.jsx)("header",{className:"bg-white shadow-sm z-10",children:(0,n.jsxs)("div",{className:"flex items-center justify-between p-4",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("button",{onClick:()=>d(!l),className:"text-gray-500 hover:text-gray-700 mr-4 p-2 rounded-md hover:bg-gray-100 transition-colors","aria-label":"Toggle sidebar",children:l?(0,n.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):(0,n.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),(0,n.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Dashboard"})]}),(0,n.jsxs)("p",{className:"text-xs text-gray-500",children:["welcome"," ",(0,n.jsx)("i",{className:"text-1xl text-green-600",children:(null==m?void 0:m.role)||""})," logged in as"," "]}),(0,n.jsx)("button",{className:"py-2 px-4 cursor-pointer font-semibold rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors duration-200",onClick:f,children:(0,n.jsx)("span",{className:"text-blue-500 hover:text-blue-700",children:"Logout"})})]})}),(0,n.jsx)("main",{className:"flex-1 overflow-y-auto bg-gray-50",children:t})]})]})}},7383:(e,r,t)=>{"use strict";function n(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)e[n]=t[n]}return e}t.d(r,{A:()=>a});var a=function e(r,t){function a(e,a,s){if("undefined"!=typeof document){"number"==typeof(s=n({},t,s)).expires&&(s.expires=new Date(Date.now()+864e5*s.expires)),s.expires&&(s.expires=s.expires.toUTCString()),e=encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var o="";for(var i in s)s[i]&&(o+="; "+i,!0!==s[i]&&(o+="="+s[i].split(";")[0]));return document.cookie=e+"="+r.write(a,e)+o}}return Object.create({set:a,get:function(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var t=document.cookie?document.cookie.split("; "):[],n={},a=0;a<t.length;a++){var s=t[a].split("="),o=s.slice(1).join("=");try{var i=decodeURIComponent(s[0]);if(n[i]=r.read(o,i),e===i)break}catch(e){}}return e?n[e]:n}},remove:function(e,r){a(e,"",n({},r,{expires:-1}))},withAttributes:function(r){return e(this.converter,n({},this.attributes,r))},withConverter:function(r){return e(n({},this.converter,r),this.attributes)}},{attributes:{value:Object.freeze(t)},converter:{value:Object.freeze(r)}})}({read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},{path:"/"})},7446:(e,r,t)=>{"use strict";t.d(r,{u:()=>o});var n=t(9483),a=t(7383),s=t(1886);let o={register:async e=>{try{return(await s.A.post("".concat("","/register/"),e)).data}catch(e){console.log("Error in AuthService.register:",e)}},login:async(e,r)=>{try{let t=await s.A.post("".concat("","/login/"),{email:e,password:r});if(200===t.status){let{access:e,refresh:r}=t.data,s={expires:1,secure:!0};return a.A.set(n.X,e,s),a.A.set(n.a,r,{...s,expires:7}),t.data}}catch(e){console.log("Error in AuthService.login: ",e)}},verifyEmail:async e=>{try{let r=await s.A.get("".concat("","/verify-email/").concat(e,"/"));if(200===r.status){let{access:e,refresh:t}=r.data,s={expires:1,secure:!0};return a.A.set(n.X,e,s),a.A.set(n.a,t,{...s,expires:7}),r.data}}catch(e){return console.log("Error in AuthService.sendVerificationEmail:",e),{error:e instanceof Error?e.message:"An error occurred while verifying email"}}},resendVerificationEmail:async e=>{try{let r=await s.A.post("".concat("","/resend-verification-email/"),{email:e});if(200===r.status)return r.data}catch(e){console.log("Error in AuthService.resendVerificationEmail:",e)}},getUserProfile:async()=>{try{return(await s.A.get("".concat("","/profile/"))).data}catch(e){console.log("Error in AuthService.getUserProfile:",e)}},logout:async()=>{try{let e=await s.A.post("".concat("","/logout/"),{refresh_token:a.A.get(n.a)});return a.A.remove(n.X),a.A.remove(n.a),e.data}catch(e){console.log("Error in AuthService.logout:",e),a.A.remove(n.X),a.A.remove(n.a)}}}},7767:(e,r,t)=>{Promise.resolve().then(t.bind(t,7151))},8869:(e,r,t)=>{"use strict";t.d(r,{A:()=>c,O:()=>l});var n=t(5155),a=t(2115),s=t(1886),o=t(7383);let i=(0,a.createContext)(void 0);function l(e){let{children:r}=e,[t,l]=(0,a.useState)(null),[c,d]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(async()=>{if(o.A.get("access_token"))try{await x()}catch(e){console.error("Failed to fetch user data:",e),m()}d(!1)})()},[]);let u=async(e,r)=>{try{let{access:t,refresh:n,user:a}=(await s.A.post("/auth/login/",{email:e,password:r})).data;o.A.set("access_token",t,{expires:1}),o.A.set("refresh_token",n,{expires:7}),l(a)}catch(e){var t,n;throw Error((null==(n=e.response)||null==(t=n.data)?void 0:t.detail)||"Login failed")}},h=async e=>{try{await s.A.post("/auth/register/",e)}catch(e){var r,t,n,a,o,i;throw Error((null==(n=e.response)||null==(t=n.data)||null==(r=t.email)?void 0:r[0])||(null==(i=e.response)||null==(o=i.data)||null==(a=o.username)?void 0:a[0])||"Registration failed")}},m=()=>{let e=o.A.get("refresh_token");e&&s.A.post("/auth/logout/",{refresh_token:e}).catch(()=>{}),o.A.remove("access_token"),o.A.remove("refresh_token"),l(null)},f=async e=>{try{let r=await s.A.patch("/auth/profile/update/",e);l(r.data)}catch(e){var r,t;throw Error((null==(t=e.response)||null==(r=t.data)?void 0:r.detail)||"Profile update failed")}},x=async()=>{try{let e=await s.A.get("/current-user/");l(e.data)}catch(e){throw e}};return(0,n.jsx)(i.Provider,{value:{user:t,loading:c,login:u,register:h,logout:m,updateProfile:f,refreshUserData:x},children:r})}function c(){let e=(0,a.useContext)(i);if(!e)throw Error("useAuth must be used within an AuthProvider");return e}},9483:(e,r,t)=>{"use strict";t.d(r,{X:()=>n,a:()=>a});let n="access_token",a="refresh_token"}},e=>{var r=r=>e(e.s=r);e.O(0,[464,874,441,684,358],()=>r(7767)),_N_E=e.O()}]);